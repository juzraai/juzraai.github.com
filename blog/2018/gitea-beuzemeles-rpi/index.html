<!DOCTYPE html> <html lang="hu"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <!-- Begin Jekyll SEO tag v2.5.0 --> <title>Gitea beüzemelés (Raspberry Pi) | Zsolt Jurányi (juzraai)</title> <meta name="generator" content="Jekyll v3.8.5" /> <meta property="og:title" content="Gitea beüzemelés (Raspberry Pi)" /> <meta name="author" content="Zsolt Jurányi" /> <meta property="og:locale" content="hu_HU" /> <meta name="description" content="Webes felületet akartam beüzemelni a Git repóim fölé, így kipróbáltam a Gitea-t. A Raspberry Pi-mre telepítettem, de a tapasztalataim platformfüggetlenek." /> <meta property="og:description" content="Webes felületet akartam beüzemelni a Git repóim fölé, így kipróbáltam a Gitea-t. A Raspberry Pi-mre telepítettem, de a tapasztalataim platformfüggetlenek." /> <link rel="canonical" href="https://juzraai.github.io/blog/2018/gitea-beuzemeles-rpi/" /> <meta property="og:url" content="https://juzraai.github.io/blog/2018/gitea-beuzemeles-rpi/" /> <meta property="og:site_name" content="Zsolt Jurányi (juzraai)" /> <meta property="og:image" content="https://juzraai.github.io/assets/facebook-og-image.png" /> <meta property="og:image:height" content="630" /> <meta property="og:image:width" content="1200" /> <meta property="og:type" content="article" /> <meta property="article:published_time" content="2018-11-03T00:00:00+01:00" /> <script type="application/ld+json"> {"description":"Webes felületet akartam beüzemelni a Git repóim fölé, így kipróbáltam a Gitea-t. A Raspberry Pi-mre telepítettem, de a tapasztalataim platformfüggetlenek.","author":{"@type":"Person","name":"Zsolt Jurányi"},"@type":"BlogPosting","url":"https://juzraai.github.io/blog/2018/gitea-beuzemeles-rpi/","image":{"width":1200,"height":630,"url":"https://juzraai.github.io/assets/facebook-og-image.png","@type":"imageObject"},"headline":"Gitea beüzemelés (Raspberry Pi)","dateModified":"2018-11-04T22:33:00+01:00","datePublished":"2018-11-03T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://juzraai.github.io/blog/2018/gitea-beuzemeles-rpi/"},"@context":"http://schema.org"}</script> <!-- End Jekyll SEO tag --> <meta property="og:image:type" content="image/png" /> <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"> <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"> <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"> <link rel="manifest" href="/site.webmanifest"> <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#016fb9"> <meta name="msapplication-TileColor" content="#016fb9"> <meta name="theme-color" content="#016fb9"> <link type="application/atom+xml" rel="alternate" href="https://juzraai.github.io/feed.xml" title="Zsolt Jurányi (juzraai)" /> <link rel="dns-prefetch" href="//fonts.googleapis.com/"> <link rel="dns-prefetch" href="//cdnjs.cloudflare.com"> <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Barlow+Condensed:300,300i,400,500,600|Inconsolata:400,700&amp;subset=latin-ext" /> <link rel="stylesheet" href="/assets/page.css" /> </head> <body> <nav class="navbar navbar-expand-lg navbar-dark bg-dark"> <div class="container"> <a class="navbar-brand" href="/">Zsolt</a> <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"> <span class="navbar-toggler-icon"></span> </button> <div class="collapse navbar-collapse" id="navbarSupportedContent"> <ul class="navbar-nav mr-auto w-100"> <li class="nav-item"> <a class="nav-link" href="/projects/hu/" target="">Munkáim</a> </li> <li class="nav-item"> <a class="nav-link" href="/blog/hu/" target="">Feljegyzéseim</a> </li> <li class="nav-item"> <a class="nav-link" href="https://github.com/juzraai" target="_blank">GitHub</a> </li> <li class="nav-item"> <a class="nav-link" href="/contact/hu/" target="">Kontakt</a> </li> </ul> </div> </div> </nav> <div class="container"> <div class="row my-5 border-bottom"> <div class="col"> <div class="mb-3 text-muted"> Nov 3, 2018 / <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/config/">#config</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/git/">#git</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/gitea/">#gitea</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/raspberry-pi/">#raspberry-pi</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/server/">#server</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/setup/">#setup</a> <a class="d-inline-block mr-1 mb-1" href="/blog/hu/tag/web-ui/">#web-ui</a> </div> <h1>Gitea beüzemelés (Raspberry Pi)</h1> </div> </div> <div class="row"> <div class="col content"> <ul class="list-unstyled mb-5 toc"> <li><a href="#bevezetés">Bevezetés</a></li> <li><a href="#telepítés">Telepítés</a></li> <li><a href="#kezdeti-beállítások">Kezdeti beállítások</a></li> <li><a href="#tapasztalatok-gyors-kipróbálás">Tapasztalatok (gyors kipróbálás)</a></li> <li><a href="#konfig">Konfig</a></li> <li><a href="#telepítés-service-ként-systemd">Telepítés service-ként (systemd)</a></li> </ul> <h2 id="bevezetés">Bevezetés</h2> <p>A munkafolyamataim hatékonyabbá és elegánsabbá tétele gyanánt azt tűztem ki célul, hogy a Git szerveremen beüzemelek egy webes felületet, amivel</p> <ul> <li>tudom browse-olni a repókat a history-juk bármely pontján</li> <li>és egyszerűen tudom kezelni a hozzáféréseket.</li> </ul> <p>Mindezt a <a href="https://www.raspberrypi.org/products/raspberry-pi-3-model-b-plus/">Raspberry Pi</a>-men akarom kikísérletezni először, mielőtt az éles szerveren beállítom. A Pi-t azért tettem zárójelbe a bejegyzés címében, mert habár a málna PC-n tesztelek, <strong>az eredményre vezető lépéssorozat igazából hardver-, platform- és rendszerfüggetlen.</strong></p> <p>Git-hez való, saját szerveren hosztolható webes felületről szerintem sokaknak a <strong><a href="https://about.gitlab.com/">GitLab</a></strong> ugrik be, ahogy nekem is. Azonban őszentsége nagyon erőforrásigényes. Ugyan találtam ARM-re való <a href="https://github.com/ulm0/gitlab">Docker image</a>-et, de a Pi nem bírta, úgyhogy a GitLab számomra felejtős egyelőre.</p> <p>Értelmes alternatívának a <a href="https://gitea.io/">Gitea</a>-t találtam, ami a <a href="https://gogs.io/">Gogs</a> forkja, picivel <a href="https://docs.gitea.io/en-us/comparison/">több funkcióval</a> és nyitottabb open-source felfogással. Eleve úgy van tervezve és fejlesztve, hogy gyengébb gépeken, ARM architektúrán és pl. Raspberry Pi-n is használható legyen.</p> <h2 id="telepítés">Telepítés</h2> <p>Meglepő módon <a href="https://docs.gitea.io/en-us/install-from-package/">nincs hozzá Debian csomag</a>, a <a href="https://hub.docker.com/r/gitea/gitea/">Docker image</a> pedig <a href="https://github.com/go-gitea/gitea/issues/5180">nem fut ARM-en</a>.</p> <p>Szerencsére a Gitea-t fejlesztő csapat egy <strong>csomó féle rendszerre elkészíti a binárisokat,</strong> melyek a <a href="https://dl.gitea.io/gitea/">honlapjukról</a> és <a href="https://github.com/go-gitea/gitea/releases">GitHub</a>-ról is letölthetőek. És van köztük ARM-re fordított bináris, több is, nekem Raspberry Pi 3B+-ra a <a href="https://dl.gitea.io/gitea/1.5.3/gitea-1.5.3-linux-arm-7">gitea-1.5.3-linux-arm-7</a> verzió kellett. Ezekben a fájlokban minden szükséges dolog megvan, <strong>csak futtatni kell</strong> őket.</p> <p>Érdemes neki létrehozni egy <strong>júzert és az alól</strong> futtatni a programot:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>useradd gitea
<span class="nb">sudo </span>su - gitea
wget https://dl.gitea.io/gitea/1.5.3/gitea-1.5.3-linux-arm-7 <span class="nt">-O</span> gitea
<span class="nb">chmod </span>u+x ./gitea
./gitea web <span class="nt">--port</span> 3000
</code></pre></div></div> <p>A Gitea-nek <strong>kelleni fog egy adatbázis.</strong> Tud SQLite-ot is használni (1 db adatfájlt jelent), de ha pl. MySQL-be vagy Postgres-be szeretnéd tárolni az adatokat, akkor érdemes előbb előkészíteni azt, mielőtt a <code class="highlighter-rouge">gitea</code> binárist elindítod. Én a teszthez maradtam az SQLite-nál.</p> <h2 id="kezdeti-beállítások">Kezdeti beállítások</h2> <p>Ha a fenti paranccsal elindítjuk a Gitea-t, elindul a szerver és a <strong>böngészőnkben</strong> a <code class="highlighter-rouge">http://localhost:3000/</code> URL-en elérjük a főoldalt. Ha bármelyik linkre rákattintunk, a telepítő képernyő fog bejönni, ahol <strong>néhány kezdeti beállítást</strong> megadhatunk, pl:</p> <ul> <li>app neve (címsorban megjelenő szöveg)</li> <li>adatbázis kapcsolódási adatok</li> <li>útvonalak</li> </ul> <p>A fentiek ellenőrzésén/módosításán kívül amit fontosnak tartok, az a mentés gomb feletti egyik lenyitható szekcióban megbúvó <strong>admin account beállítás.</strong> Érdemes itt megadni az adminisztrátor felhasználó adatait, pláne, ha letiltod a regisztrációt. Egyébként az első regisztrált júzer lesz az adminisztrátor.</p> <p>Amikor ezt az űrlapot leokézzuk, a Gitea 1-2 percig (legalábbis Pi-n) elmolyol a mappák, konfigfájlok és adatbázistáblák létrehozásával, utána bejön a login képernyő és kezdhetünk vele játszani.</p> <p>A megadott beállítások és még <strong>rengeteg paraméter</strong> később is módosítható a konfigfájlban (<code class="highlighter-rouge">custom/conf/app.ini</code>). Mielőtt komolyabban elkezdenénk használni a Gitea-t, érdemes <strong>végigolvasni</strong> az <a href="https://docs.gitea.io/en-us/config-cheat-sheet/">összes beállítási lehetőséget</a>.</p> <h2 id="tapasztalatok-gyors-kipróbálás">Tapasztalatok (gyors kipróbálás)</h2> <p>A HTTP clone/push gyönyörűen működik a webes felület user+pass kombójával. Az SSH módszernél a clone URL generálás nem az igazi, a Git repók mappáját lehagyja az URL-ből, viszont a <strong>saját beépített SSH szerverével</strong> frankón megy ez is. A webes felületen a profil beállításainál fel lehet tölteni SSH/RSA publikus kulcsot.</p> <p><strong>Meglévő repók importálása</strong> is pofon egyszerű, ez nekem nagyon fontos volt. Persze órákig kísérleteztem vele, mire rájöttem a nyitjára - erről <a href="/blog/2018/lokalis-repok-importalasa-gitea-be">külön posztban</a> írok.</p> <p>A webes felületet és funkciókat tekintve <strong>gyakorlatilag egy GitHub klónt</strong> kapunk. (Issues, PR, issue/pr templates, organizations, teams, etc.)</p> <h2 id="konfig">Konfig</h2> <p>Én az alábbiakat adtam hozzá kézzel a telepítő által kiköpött konfig fájlhoz. Ez nyilván nem lesz mindenkinek megfelelő, ízelítőként, illetve saját feljegyzésként (note to self) teszem ide.</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[repository]</span>
<span class="py">DEFAULT_PRIVATE</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">FORCE_PRIVATE</span> <span class="p">=</span> <span class="s">true</span>

<span class="nn">[security]</span>
<span class="py">DISABLE_GIT_HOOKS</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">IMPORT_LOCAL_PATHS</span> <span class="p">=</span> <span class="s">true</span>

<span class="nn">[server]</span>
<span class="py">DISABLE_ROUTER_LOG</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">START_SSH_SERVER</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">SSH_PORT</span> <span class="p">=</span> <span class="s">2222</span>

<span class="nn">[service]</span>
<span class="py">DISABLE_REGISTRATION</span> <span class="p">=</span> <span class="s">true</span>
<span class="py">REQUIRE_SIGNIN_VIEW</span> <span class="p">=</span> <span class="s">true</span>
</code></pre></div></div> <h2 id="telepítés-service-ként-systemd">Telepítés service-ként (systemd)</h2> <p>Miután megbizonyosodtam róla, hogy jó lesz ez a cucc, beállítottam service-ként, hogy induljon a géppel automatikusan. Létrehoztam egy <code class="highlighter-rouge">gitea.service</code> fájlt az alábbi tartalommal:</p> <div class="language-ini highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[Unit]</span>
<span class="py">Description</span><span class="p">=</span><span class="s">Gitea</span>
<span class="py">After</span><span class="p">=</span><span class="s">network.target</span>

<span class="nn">[Service]</span>
<span class="py">Type</span><span class="p">=</span><span class="s">simple</span>
<span class="py">User</span><span class="p">=</span><span class="s">gitea</span>
<span class="py">Group</span><span class="p">=</span><span class="s">gitea</span>
<span class="py">WorkingDirectory</span><span class="p">=</span><span class="s">/home/gitea</span>
<span class="py">ExecStart</span><span class="p">=</span><span class="s">/home/gitea/gitea web --port 3000</span>
<span class="py">Restart</span><span class="p">=</span><span class="s">always</span>

<span class="nn">[Install]</span>
<span class="py">WantedBy</span><span class="p">=</span><span class="s">multi-user.target</span>
</code></pre></div></div> <p>Majd az alábbi parancsokkal telepítettem és elindítottam:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl <span class="nb">enable</span> /home/gitea/gitea.service
service gitea start
</code></pre></div></div> </div> </div> <div class="row mt-3"> <div class="col text-center"> <script> if (!window.scripts) window.scripts = []; window.scripts = window.scripts.concat('https://connect.facebook.net/hu_HU/sdk.js#xfbml=1&version=v3.0'); </script> <div class="fb-like" data-href="https://juzraai.github.io/blog/2018/gitea-beuzemeles-rpi/" data-layout="button_count" data-action="like" data-size="large" data-show-faces="false" data-share="true"></div> </div> </div> <div class="row my-5 border-top"> <div class="col-md-8 mt-3"> <big class="font-weight-normal text-dark"> <strong>Zsolt vagyok,</strong> full-stack fejlesztő. </big> <br> Crawlereket, webalkalmazásokat, statikus honlapokat és interaktív vizualizációkat készítek. </div> <div class="col mt-3 small"> <ul class="list-unstyled d-flex d-md-block pl-md-3"> <li class="mr-3 mr-md-0"><a href="/projects/hu/" target="">Munkáim</a></li> <li class="mr-3 mr-md-0"><a href="/blog/hu/" target="">Feljegyzéseim</a></li> <li class="mr-3 mr-md-0"><a href="https://github.com/juzraai" target="_blank">GitHub</a></li> <li class="mr-3 mr-md-0"><a href="/contact/hu/" target="">Kontakt</a></li> </ul> </div> </div> <div class="row"> <div class="col mb-3 small text-center text-muted"> Copyright &copy; 2018 Zsolt Jurányi | All rights reserved. </div> </div> </div> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/js/bootstrap.min.js"></script> <script>$(function () { $('a[href^=http]').attr('target', '_blank'); })</script> <script> if (!window.scripts) window.scripts = []; window.scripts = window.scripts.concat('https://www.googletagmanager.com/gtag/js?id=UA-41050675-1'); window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'UA-41050675-1', { 'anonymize_ip': true }); </script> <div id="cc" style="display:none"> <div class="c" onclick="ccClear()"></div> <div class="p"> <p> A honlap helyes működéséhez és némi statisztikához szeretnék sütiket használni. <a href="/privacy/hu/">Részletek</a> </p> <div class="r"> <a href="javascript:void(0)" onclick="ccDeny()">Elrejtés</a> <a class="b" href="javascript:void(0)" onclick="ccAllow()">Engedélyezem</a> </div> </div> </div> <script> /* js-cookie v2.2.0 */ !function(e){var n=!1;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var o=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=o,t}}}(function(){function e(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}function n(o){function t(n,r,i){var c;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(i=e({path:"/"},t.defaults,i)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*i.expires),i.expires=a}i.expires=i.expires?i.expires.toUTCString():"";try{/^[\{\[]/.test(c=JSON.stringify(r))&&(r=c)}catch(e){}r=o.write?o.write(r,n):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),n=(n=(n=encodeURIComponent(String(n))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var s="";for(var f in i)i[f]&&(s+="; "+f,!0!==i[f]&&(s+="="+i[f]));return document.cookie=n+"="+r+s}n||(c={});for(var p=document.cookie?document.cookie.split("; "):[],d=/(%[0-9A-Z]{2})+/g,u=0;u<p.length;u++){var l=p[u].split("="),C=l.slice(1).join("=");this.json||'"'!==C.charAt(0)||(C=C.slice(1,-1));try{var g=l[0].replace(d,decodeURIComponent);if(C=o.read?o.read(C,g):o(C,g)||C.replace(d,decodeURIComponent),this.json)try{C=JSON.parse(C)}catch(e){}if(n===g){c=C;break}n||(c[g]=C)}catch(e){}}return c}}return t.set=t,t.get=function(e){return t.call(t,e)},t.getJSON=function(){return t.apply({json:!0},[].slice.call(arguments))},t.defaults={},t.remove=function(n,o){t(n,"",e(o,{expires:-1}))},t.withConverter=n,t}return n(function(){})}); function addClass(element, className) { element.className += ' ' + className; } function removeClass(element, className) { element.className = element.className.replace( new RegExp('( |^)' + className + '( |$)', 'g'), ' ').trim(); } var c = 'juzraai-cc-v1'; function ccInit() { var v = Cookies.get(c); var e = document.getElementById('cc'); if ('allow' == v) { e.style.display = 'none'; ccLoadScripts(); } else { if ('deny' == v) { addClass(e, 'small'); } else { removeClass(e, 'small'); } e.style.display = null; } } function ccAllow() { Cookies.set(c, 'allow', { expires: 365 }); ccInit(); } function ccClear() { Cookies.remove(c); ccInit(); } function ccDeny() { Cookies.set(c, 'deny', { expires: 7 }); ccInit(); } function ccLoadScripts() { if (!window.scripts) window.scripts = []; for (var i = 0; i < window.scripts.length; i++) { var script = document.createElement('script'); script.src = window.scripts[i]; document.body.appendChild(script); } } ccInit(); </script> </body> </html>
